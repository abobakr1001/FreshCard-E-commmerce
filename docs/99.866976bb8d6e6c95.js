"use strict";(self.webpackChunkfreshcart=self.webpackChunkfreshcart||[]).push([[99],{4768:(w,f,c)=>{c.d(f,{e:()=>h});var d=c(6726),r=c(5619);const t_baseUrlAuth="https://ecommerce.routemisr.com/api/v1/auth";var g=c(9468),p=c(9862),u=c(2956);let h=(()=>{class m{constructor(i,l){this._HttpClient=i,this._Router=l,this.userData=new r.X(null),this.saveUser()}saveUser(){const i=localStorage.getItem("_token");if(i)try{const l=(0,d.Z)(i);l.name&&this.userData.next(l)}catch(l){l.message.includes("Invalid token")&&(localStorage.removeItem("_token"),this._Router.navigate(["/login"]))}}setRegister(i){return this._HttpClient.post(t_baseUrlAuth+"/signup",i)}setLogin(i){return this._HttpClient.post(t_baseUrlAuth+"/signin",i)}setForgotPassword(i){return this._HttpClient.post(t_baseUrlAuth+"/forgotPasswords",i)}setVerifyResetCode(i){return this._HttpClient.post(t_baseUrlAuth+"/verifyResetCode",i)}resetPassword(i){return this._HttpClient.put(t_baseUrlAuth+"/resetPassword",i)}setChangePassword(i){return this._HttpClient.put("https://ecommerce.routemisr.com/api/v1/users/changeMyPassword",i)}static#t=this.\u0275fac=function(l){return new(l||m)(g.LFG(p.eN),g.LFG(u.F0))};static#o=this.\u0275prov=g.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})}return m})()},8099:(w,f,c)=>{c.r(f),c.d(f,{ForgotpasswordComponent:()=>S});var d=c(6814),r=c(95),t=c(9468),g=c(491),p=c(4768),u=c(2956);const h=["form1"],m=["form2"],x=["form3"];function i(e,s){1&e&&(t.TgZ(0,"p",14),t._uU(1," Email is required "),t.qZA())}function l(e,s){1&e&&(t.TgZ(0,"p",14),t._uU(1," Email InValid Format "),t.qZA())}function C(e,s){if(1&e&&(t.ynx(0),t.YNc(1,i,2,0,"p",13),t.YNc(2,l,2,0,"p",13),t.BQk()),2&e){const o=t.oxw(2);t.xp6(1),t.Q6J("ngIf",o.f.email.getError("required")),t.xp6(1),t.Q6J("ngIf",o.f.email.getError("email"))}}function v(e,s){if(1&e&&(t.TgZ(0,"button",15),t._uU(1," Next "),t.qZA()),2&e){const o=t.oxw(2);t.Q6J("disabled",o.forgotForm.invalid)}}function b(e,s){1&e&&(t.TgZ(0,"button",16)(1,"span"),t._UZ(2,"i",17),t.qZA()())}function Z(e,s){if(1&e&&(t.TgZ(0,"p",18),t._uU(1),t.qZA()),2&e){const o=t.oxw(2);t.xp6(1),t.hij(" ",o.errMsg," ")}}function T(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"form",4,5),t.NdJ("ngSubmit",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.handleForgotPassword())}),t.TgZ(2,"div",6)(3,"label",7),t._uU(4,"Email:"),t.qZA(),t._UZ(5,"input",8),t.YNc(6,C,3,2,"ng-container",9),t.qZA(),t.YNc(7,v,2,1,"button",10),t.YNc(8,b,3,0,"button",11),t.YNc(9,Z,2,1,"p",12),t.qZA()}if(2&e){const o=t.oxw();t.Q6J("formGroup",o.forgotForm),t.xp6(6),t.Q6J("ngIf",o.f.email.errors&&(o.f.email.touched||o.f.email.value.length>0)),t.xp6(1),t.Q6J("ngIf",!o.isLoading),t.xp6(1),t.Q6J("ngIf",o.isLoading),t.xp6(1),t.Q6J("ngIf",o.errMsg)}}function F(e,s){1&e&&(t.TgZ(0,"p",14),t._uU(1," resetCode is required "),t.qZA())}function I(e,s){1&e&&(t.TgZ(0,"p",14),t._uU(1," must be at 6 chars "),t.qZA())}function U(e,s){if(1&e&&(t.ynx(0),t.YNc(1,F,2,0,"p",13),t.YNc(2,I,2,0,"p",13),t.BQk()),2&e){const o=t.oxw(2);t.xp6(1),t.Q6J("ngIf",o.r.resetCode.getError("required")),t.xp6(1),t.Q6J("ngIf",o.r.resetCode.getError("pattern"))}}function A(e,s){if(1&e&&(t.TgZ(0,"button",15),t._uU(1," Confirm "),t.qZA()),2&e){const o=t.oxw(2);t.Q6J("disabled",o.verifyCode.invalid)}}function P(e,s){1&e&&(t.TgZ(0,"button",16)(1,"span"),t._UZ(2,"i",17),t.qZA()())}function N(e,s){if(1&e&&(t.TgZ(0,"p",18),t._uU(1),t.qZA()),2&e){const o=t.oxw(2);t.xp6(1),t.hij(" ",o.errMsg," ")}}function J(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"form",4,19),t.NdJ("ngSubmit",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.handleVerifyResetCode())}),t.TgZ(2,"div",6)(3,"label",20),t._uU(4,"Reset Code:"),t.qZA(),t._UZ(5,"input",21),t.YNc(6,U,3,2,"ng-container",9),t.qZA(),t.YNc(7,A,2,1,"button",10),t.YNc(8,P,3,0,"button",11),t.YNc(9,N,2,1,"p",12),t.qZA()}if(2&e){const o=t.oxw();t.Q6J("formGroup",o.verifyCode),t.xp6(6),t.Q6J("ngIf",o.r.resetCode.errors&&(o.r.resetCode.touched||o.r.resetCode.value.length>0)),t.xp6(1),t.Q6J("ngIf",!o.isLoading),t.xp6(1),t.Q6J("ngIf",o.isLoading),t.xp6(1),t.Q6J("ngIf",o.errMsg)}}function Q(e,s){1&e&&(t.TgZ(0,"p",14),t._uU(1," Email is required "),t.qZA())}function E(e,s){1&e&&(t.TgZ(0,"p",14),t._uU(1," Email InValid Format "),t.qZA())}function M(e,s){if(1&e&&(t.ynx(0),t.YNc(1,Q,2,0,"p",13),t.YNc(2,E,2,0,"p",13),t.BQk()),2&e){const o=t.oxw(2);t.xp6(1),t.Q6J("ngIf",o.c.email.getError("required")),t.xp6(1),t.Q6J("ngIf",o.c.email.getError("email"))}}function Y(e,s){1&e&&(t.TgZ(0,"p",26),t._uU(1," New Password Is Required "),t.qZA())}function q(e,s){1&e&&(t.TgZ(0,"p",26),t._uU(1," Must be at least 6 chars "),t.qZA())}function y(e,s){if(1&e&&(t.ynx(0),t.YNc(1,Y,2,0,"p",25),t.YNc(2,q,2,0,"p",25),t.BQk()),2&e){const o=t.oxw(2);t.xp6(1),t.Q6J("ngIf",o.c.newPassword.getError("required")),t.xp6(1),t.Q6J("ngIf",o.c.newPassword.getError("pattern"))}}function L(e,s){if(1&e&&(t.TgZ(0,"button",15),t._uU(1," Done "),t.qZA()),2&e){const o=t.oxw(2);t.Q6J("disabled",o.resetPassword.invalid)}}function R(e,s){1&e&&(t.TgZ(0,"button",16)(1,"span"),t._UZ(2,"i",17),t.qZA()())}function k(e,s){if(1&e&&(t.TgZ(0,"p",18),t._uU(1),t.qZA()),2&e){const o=t.oxw(2);t.xp6(1),t.hij(" ",o.errMsg," ")}}function D(e,s){if(1&e){const o=t.EpF();t.TgZ(0,"form",4,22),t.NdJ("ngSubmit",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.handleResetPassword())}),t.TgZ(2,"div",6)(3,"label",7),t._uU(4,"Email:"),t.qZA(),t._UZ(5,"input",8),t.YNc(6,M,3,2,"ng-container",9),t.qZA(),t.TgZ(7,"div",6)(8,"label",23),t._uU(9,"newPassword:"),t.qZA(),t._UZ(10,"input",24),t.YNc(11,y,3,2,"ng-container",9),t.qZA(),t.YNc(12,L,2,1,"button",10),t.YNc(13,R,3,0,"button",11),t.YNc(14,k,2,1,"p",12),t.qZA()}if(2&e){const o=t.oxw();t.Q6J("formGroup",o.resetPassword),t.xp6(6),t.Q6J("ngIf",o.c.email.errors&&(o.c.email.touched||o.c.email.value.length>0)),t.xp6(5),t.Q6J("ngIf",o.c.newPassword.errors&&(o.c.newPassword.value.length||o.c.newPassword.touched)),t.xp6(1),t.Q6J("ngIf",!o.isLoading),t.xp6(1),t.Q6J("ngIf",o.isLoading),t.xp6(1),t.Q6J("ngIf",o.errMsg)}}let S=(()=>{class e{constructor(o,n,a,_){this.dialogRef=o,this._AuthService=n,this._Renderer2=a,this._Router=_,this.first=!0,this.seconde=!1,this.done=!1,this.isLoading=!1,this.errMsg="",this.email=""}closeDialog(){this.dialogRef.close()}onNoClick(){this.dialogRef.close()}ngOnInit(){this.forgotForm=new r.cw({email:new r.NI("",[r.kI.required,r.kI.email])}),this.verifyCode=new r.cw({resetCode:new r.NI("",[r.kI.required,r.kI.pattern(/^\d{6}$/)])}),this.resetPassword=new r.cw({email:new r.NI("",[r.kI.required,r.kI.email]),newPassword:new r.NI("",[r.kI.required,r.kI.pattern(/^\w{6,}$/)])})}get f(){return this.forgotForm.controls}get r(){return this.verifyCode.controls}get c(){return this.resetPassword.controls}handleForgotPassword(){this.isLoading=!0,this.forgotForm.valid&&(console.log(this.forgotForm.value),this._AuthService.setForgotPassword(this.forgotForm.value).subscribe({next:o=>{console.log(o),"success"===o.statusMsg&&(this.errMsg=o.message,this.isLoading=!1,this.forgotForm.disable(),this.email=this.forgotForm.get("email")?.value,this.first=!1,this.seconde=!0)},error:o=>{console.log(o),this.errMsg=o.error.message,this.isLoading=!1}}))}handleVerifyResetCode(){this.isLoading=!0,this.verifyCode.valid&&(console.log(this.verifyCode.value),this._AuthService.setVerifyResetCode(this.verifyCode.value).subscribe({next:o=>{console.log(o),"Success"===o.status&&(this.errMsg=o.status,this.isLoading=!1,this.verifyCode.disable(),this.seconde=!1,this.done=!0,this.resetPassword.get("email")?.setValue(this.email),this.resetPassword.get("email")?.disable())},error:o=>{console.log(o),this.errMsg=o.error.message,this.isLoading=!1}}))}handleResetPassword(){if(this.isLoading=!0,this.resetPassword.valid){console.log(this.resetPassword.value);const o={email:this.email,newPassword:this.resetPassword.get("newPassword")?.value};this._AuthService.resetPassword(o).subscribe({next:n=>{console.log(n),n?.token&&(this.errMsg=n.message,localStorage.setItem("_token",n?.token),this._AuthService.saveUser(),this.isLoading=!1,this.resetPassword.disable(),setTimeout(()=>{this._Router.navigate(["/home"])},1e3))},error:n=>{console.log(n),this.errMsg=n.error.message,this.isLoading=!1}})}}static#t=this.\u0275fac=function(n){return new(n||e)(t.Y36(g.so),t.Y36(p.e),t.Y36(t.Qsj),t.Y36(u.F0))};static#o=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-forgotpassword"]],viewQuery:function(n,a){if(1&n&&(t.Gf(h,5),t.Gf(m,5),t.Gf(x,5)),2&n){let _;t.iGM(_=t.CRH())&&(a.form1=_.first),t.iGM(_=t.CRH())&&(a.form2=_.first),t.iGM(_=t.CRH())&&(a.form3=_.first)}},standalone:!0,features:[t.jDz],decls:8,vars:3,consts:[[1,"bg-main-light","w-100","rounded","p-3","shadow","w-50","mx-auto"],[1,"text-center","h3"],["class","vstack gap-3",3,"formGroup","ngSubmit",4,"ngIf"],["routerLink","/login","routerLinkActive","router-link-active",1,"btn","btn-outline-success",3,"click"],[1,"vstack","gap-3",3,"formGroup","ngSubmit"],["form1",""],[1,"form-item"],["for","email"],["type","email","formControlName","email","placeholder","Your Email...",1,"form-control"],[4,"ngIf"],["class","main-btn",3,"disabled",4,"ngIf"],["type","button","disabled","","class","main-btn ms-auto",4,"ngIf"],["class","alert alert-danger text-center w-50 mx-auto mb-0 p-1 mt-3",4,"ngIf"],["class","alert alert-danger w-50 p-1 small",4,"ngIf"],[1,"alert","alert-danger","w-50","p-1","small"],[1,"main-btn",3,"disabled"],["type","button","disabled","",1,"main-btn","ms-auto"],[1,"fas","fa-spinner","fa-spin"],[1,"alert","alert-danger","text-center","w-50","mx-auto","mb-0","p-1","mt-3"],["form2",""],["for","resetCode"],["type","text","formControlName","resetCode","placeholder","Your Reset Code...",1,"form-control"],["form3",""],["for","newPassword"],["type","password","formControlName","newPassword","placeholder","Your newPassword...",1,"form-control"],["class","alert alert-danger w-50 mx-auto p-1 mb-0",4,"ngIf"],[1,"alert","alert-danger","w-50","mx-auto","p-1","mb-0"]],template:function(n,a){1&n&&(t.TgZ(0,"section",0)(1,"h1",1),t._uU(2,"Forgot Password"),t.qZA(),t.YNc(3,T,10,5,"form",2),t.YNc(4,J,10,5,"form",2),t.YNc(5,D,15,6,"form",2),t.qZA(),t.TgZ(6,"button",3),t.NdJ("click",function(){return a.closeDialog()}),t._uU(7,"close"),t.qZA()),2&n&&(t.xp6(3),t.Q6J("ngIf",a.first),t.xp6(1),t.Q6J("ngIf",a.seconde),t.xp6(1),t.Q6J("ngIf",a.done))},dependencies:[d.ez,d.O5,r.UX,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u]})}return e})()}}]);